
本功能所在位置为设置界面，主动回复设置。

# 实现思路
调用一个独立的大模型作为AI管家（防止污染聊天上下文），在每次对话结束后管理触发器列表，同时根据历史对话和女友人设预生成最近时间的触发器的消息内容。前期调试在主动回复设置里暴露出提示词。

# 关于触发器列表
根据系统时间实时设定触发时间，过期的触发器自动清理，超时未成功触发的进入冻结状态，等待ai管家处理。同时AI管家需要根据最新的上下文清理未来重复的、过时的触发器。
每个触发器需要有三个时间戳，触发时间，最初创建时间，最后一次更新时间。

# 关于一轮对话结束的判定
采用 **防抖 (Debounce)** 机制：
用户切后台、停止输入或最后一条消息发送后，启动一个 5 分钟的倒计时。
如果在倒计时结束前用户又有操作（发消息、切回前台），则重置倒计时。
只有当倒计时完整走完 5 分钟，才视为对话结束，调用 AI 进行触发器整理。
（优先适配安卓端，使用 WorkManager。iOS 需要云端兜底。）

# 关于云端保底机制
**关键前提：数据同步**。在判定对话结束准备移交云端前，必须尝试将本地最新的聊天记录同步至云端。
给云服务器一个实时时间戳，云服务器在 5 分钟后查询触发器列表的最后更新时间。如果此时间不是返回时间戳之后的时间，则云服务器接管触发器列表，运行后本地相同的流程。

# 关于对话期间的触发器处理
将触发器分为高、中、低三个等级。
高级触发器必定触发，一般不是文本消息，而是语音电话或者视频电话（目前待扩展，留好接口）
中级触发器则是有时效性的内容，如果需要触发，就实时插入给 AI 的消息，附在用户消息的最后边。
低级触发器则是无关紧要的，AI 的主动回复，例如撒娇、想念一类。**直接丢弃 (Drop)**，不触发也不冻结。因为聊天正在进行中，情感需求已得到满足，无需累积旧的情感触发器。

# 与聊天ai的交互
同时为了更好的ai女友扮演效果，对于扮演女友专门聊天的ai，开启主动回复设置后，在扮演女友的ai的提示词里加入关于触发器消息的说明。“会有旁白提醒你主动发消息，如...”

