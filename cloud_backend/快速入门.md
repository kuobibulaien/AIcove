# Cloud Backend å¿«é€Ÿå…¥é—¨ï¼ˆ5åˆ†é’Ÿä¸Šæ‰‹ï¼‰

## ğŸ¯ å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ

ä¸€ä¸ªæç®€çš„äº‘å­˜å‚¨æœåŠ¡å™¨ï¼Œåªåš3ä»¶äº‹ï¼š
1. **ç®¡è´¦å·**ï¼šæ³¨å†Œã€ç™»å½•
2. **å­˜æ•°æ®**ï¼šä¿å­˜èŠå¤©è®°å½•ã€è§’è‰²ä¿¡æ¯
3. **åŒæ­¥**ï¼šå¤šè®¾å¤‡æ•°æ®ä¸€è‡´

**ä¸åšçš„äº‹ï¼š**
- âŒ ä¸è´Ÿè´£AIå¯¹è¯ï¼ˆFlutteråšï¼‰
- âŒ ä¸è°ƒç”¨OpenAIï¼ˆFlutteråšï¼‰

---

## ğŸš€ 30ç§’å¯åŠ¨

### Windows:
```powershell
cd cloud_backend
.\start.ps1
```

### Linux/Mac:
```bash
cd cloud_backend
./start.sh
```

è®¿é—®ï¼šhttp://localhost:8000/docs

---

## ğŸ“ ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼ˆ3æ­¥ï¼‰

### ç¬¬1æ­¥ï¼šåˆ›å»ºç®¡ç†å‘˜
```bash
curl -X POST http://localhost:8000/api/v1/auth/bootstrap-admin \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**è¿”å›ï¼š**
```json
{
  "access_token": "eyJhbGc...",
  "user": {
    "id": 1,
    "username": "admin",
    "is_admin": true
  }
}
```

**ä¿å­˜è¿™ä¸ªtokenï¼** åé¢è¦ç”¨ã€‚

### ç¬¬2æ­¥ï¼šåˆ›å»ºé‚€è¯·ç 
```bash
curl -X POST http://localhost:8000/api/v1/admin/invites \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGc..." \
  -d '{"code":"WELCOME","max_uses":100}'
```

**è¿”å›ï¼š**
```json
{
  "code": "WELCOME",
  "max_uses": 100,
  "used_count": 0
}
```

### ç¬¬3æ­¥ï¼šæ™®é€šç”¨æˆ·æ³¨å†Œ
```bash
curl -X POST http://localhost:8000/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username":"zhangsan",
    "password":"123456",
    "invite_code":"WELCOME"
  }'
```

**è¿”å›ï¼š**
```json
{
  "access_token": "eyJhbGc...",
  "user": {
    "id": 2,
    "username": "zhangsan"
  }
}
```

å®Œæˆï¼ç°åœ¨å¯ä»¥åœ¨Flutterä¸­ç™»å½•äº†ã€‚

---

## ğŸ”„ æ•°æ®åŒæ­¥æµç¨‹

### ä¸Šä¼ è”ç³»äººï¼š
```bash
curl -X POST http://localhost:8000/api/v1/sync/contacts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "items": [{
      "contact_id": "uuid-123",
      "name": "å°ç¾",
      "avatar_url": "https://example.com/avatar.jpg",
      "character_data": {
        "system_prompt": "ä½ æ˜¯ä¸€ä¸ªæ¸©æŸ”çš„å¥³å‹"
      },
      "updated_at": "2025-01-14T10:00:00Z"
    }]
  }'
```

### è·å–è”ç³»äººï¼š
```bash
curl http://localhost:8000/api/v1/sync/contacts \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### ä¸Šä¼ æ¶ˆæ¯ï¼š
```bash
curl -X POST http://localhost:8000/api/v1/sync/messages \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "items": [{
      "message_id": "msg-456",
      "contact_id": "uuid-123",
      "role": "user",
      "content": "ä½ å¥½",
      "created_at": "2025-01-14T10:05:00Z"
    }]
  }'
```

---

## ğŸ“ é‡è¦æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| æ•°æ®åº“ | `data/sync.db` | æ‰€æœ‰æ•°æ®å­˜è¿™é‡Œ |
| é…ç½® | `.env` | ç¯å¢ƒå˜é‡é…ç½® |
| æ—¥å¿— | ç»ˆç«¯è¾“å‡º | æŸ¥çœ‹è¿è¡Œæ—¥å¿— |

---

## ğŸ”§ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·ï¼š
```bash
curl http://localhost:8000/api/v1/admin/users \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

### æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡ï¼š
```bash
curl http://localhost:8000/api/v1/admin/stats \
  -H "Authorization: Bearer ADMIN_TOKEN"
```

### å¤‡ä»½æ•°æ®åº“ï¼š
```bash
cp data/sync.db data/backup_$(date +%Y%m%d).db
```

### é‡å¯æœåŠ¡ï¼š
```bash
# Dockeræ–¹å¼
docker-compose restart

# ç›´æ¥è¿è¡Œ
# Ctrl+C åœæ­¢ï¼Œç„¶åé‡æ–°è¿è¡Œå¯åŠ¨è„šæœ¬
```

---

## ğŸŒ éƒ¨ç½²åˆ°æœåŠ¡å™¨

### 1. è´­ä¹°æœåŠ¡å™¨
- é˜¿é‡Œäº‘/è…¾è®¯äº‘ï¼š60-100å…ƒ/æœˆ
- DigitalOcean/Vultrï¼š5ç¾å…ƒ/æœˆ

### 2. SSHè¿æ¥
```bash
ssh root@your-server-ip
```

### 3. å®‰è£…Docker
```bash
curl -fsSL https://get.docker.com | sh
```

### 4. éƒ¨ç½²
```bash
# å…‹éš†ä»£ç 
git clone your-repo.git
cd your-repo/cloud_backend

# é…ç½®
cp .env.example .env
nano .env  # ä¿®æ”¹SECRET_KEY

# å¯åŠ¨
docker-compose up -d
```

### 5. é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰
```bash
# å®‰è£…Nginx
apt install nginx certbot python3-certbot-nginx

# é…ç½®ï¼ˆåˆ›å»º /etc/nginx/sites-available/mygrilï¼‰
server {
    listen 80;
    server_name api.yourdomain.com;
    location / {
        proxy_pass http://127.0.0.1:8000;
    }
}

# å¯ç”¨
ln -s /etc/nginx/sites-available/mygril /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx

# ç”³è¯·SSL
certbot --nginx -d api.yourdomain.com
```

å®Œæˆï¼è®¿é—® https://api.yourdomain.com

---

## ğŸ“± Flutterè¿æ¥

### å¼€å‘æ¨¡å¼ï¼ˆæœ¬åœ°æµ‹è¯•ï¼‰ï¼š
```bash
flutter run --dart-define=API_BASE_URL=http://localhost:8000
```

### ç”Ÿäº§æ¨¡å¼ï¼ˆæœåŠ¡å™¨ï¼‰ï¼š
```bash
flutter run --dart-define=API_BASE_URL=https://api.yourdomain.com
```

æˆ–åœ¨ä»£ç ä¸­ä¿®æ”¹ `lib/src/features/sync/providers/auth_provider.dart`ï¼š
```dart
const baseUrl = 'https://api.yourdomain.com';
```

---

## ğŸ› é‡åˆ°é—®é¢˜ï¼Ÿ

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹å ç”¨
lsof -i :8000  # Linux/Mac
netstat -ano | findstr :8000  # Windows

# ä¿®æ”¹ç«¯å£ï¼ˆ.envï¼‰
PORT=8080
```

### å¿˜è®°ç®¡ç†å‘˜å¯†ç 
```bash
# åˆ é™¤æ•°æ®åº“é‡æ¥
rm data/sync.db
python main.py
# é‡æ–°åˆ›å»ºç®¡ç†å‘˜
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# Dockeræ–¹å¼
docker-compose logs -f

# ç›´æ¥è¿è¡Œ
# æ—¥å¿—æ˜¾ç¤ºåœ¨ç»ˆç«¯
```

### æ•°æ®åº“æŸå
```bash
# æ¢å¤å¤‡ä»½
cp data/backup_20250114.db data/sync.db
```

---

## ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ 

**è¯¦ç»†æ–‡æ¡£ï¼š**
- [å®Œæ•´åŠŸèƒ½è¯´æ˜](åŠŸèƒ½è¯´æ˜.md) - æ¯ä¸ªåŠŸèƒ½çš„è¯¦ç»†è§£é‡Š
- [APIæ–‡æ¡£](http://localhost:8000/docs) - å¯åŠ¨åè®¿é—®

**æµ‹è¯•å·¥å…·ï¼š**
- Postman - å›¾å½¢åŒ–APIæµ‹è¯•
- curl - å‘½ä»¤è¡Œæµ‹è¯•
- Swagger UI - è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£

---

## âœ… æ£€æŸ¥æ¸…å•

å¯åŠ¨æˆåŠŸçš„æ ‡å¿—ï¼š
- [ ] è®¿é—® http://localhost:8000 æ˜¾ç¤ºæœåŠ¡ä¿¡æ¯
- [ ] è®¿é—® http://localhost:8000/health æ˜¾ç¤º `{"status":"ok"}`
- [ ] è®¿é—® http://localhost:8000/docs æ˜¾ç¤ºAPIæ–‡æ¡£
- [ ] èƒ½åˆ›å»ºç®¡ç†å‘˜è´¦å·
- [ ] èƒ½æ³¨å†Œæ™®é€šç”¨æˆ·
- [ ] Flutterèƒ½è¿æ¥å¹¶ç™»å½•

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µé€Ÿè®°

| æ¦‚å¿µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| Token | ç™»å½•å‡­è¯ | `eyJhbGc...` |
| contact_id | è”ç³»äººå”¯ä¸€ID | `uuid-123` |
| message_id | æ¶ˆæ¯å”¯ä¸€ID | `msg-456` |
| role | æ¶ˆæ¯è§’è‰² | `user` / `assistant` |
| updated_at | æ›´æ–°æ—¶é—´ | `2025-01-14T10:00:00Z` |

---

## ğŸ‰ æ­å–œï¼

ä½ ç°åœ¨å·²ç»ä¼šï¼š
- âœ… å¯åŠ¨åç«¯
- âœ… åˆ›å»ºè´¦å·
- âœ… æµ‹è¯•API
- âœ… åŒæ­¥æ•°æ®
- âœ… éƒ¨ç½²åˆ°æœåŠ¡å™¨

**ä¸‹ä¸€æ­¥ï¼š**
åœ¨Flutteråº”ç”¨ä¸­ç™»å½•ï¼Œäº«å—äº‘åŒæ­¥åŠŸèƒ½ï¼ğŸš€
